Copilot said: # üîç META-PROMPT ‚Äî VERIFICA√á√ÉO DIAGN√ìSTICA PR√â-REMEDIA√á√ÉO --- ##
üîç META-PROMPT ‚Äî VERIFICA√á√ÉO DIAGN√ìSTICA PR√â-REMEDIA√á√ÉO
Objetivo
Antes de executar qualquer corre√ß√£o, voc√™ deve mapear o estado atual do reposit√≥rio para confirmar quais riscos identificados na auditoria realmente existem e qual a severidade real de cada um.

N√ÉO execute corre√ß√µes nesta fase. Apenas colete evid√™ncias.

Contexto
Reposit√≥rio: LionGab/NossaMaternidade
Branch principal: main
Stack: React Native + Expo SDK 54 + TypeScript strict + NativeWind v4

Auditoria identificou 5 riscos cr√≠ticos/altos. Sua miss√£o √© validar cada risco com evid√™ncia concreta antes de planejar remedia√ß√£o.

Instru√ß√µes de Execu√ß√£o
Princ√≠pios
Evid√™ncia > Suposi√ß√£o ‚Äî Sempre rodar comando/busca antes de afirmar
Quantificar ‚Äî N√£o diga "v√°rios arquivos"; diga "12 arquivos em src/components/"
Priorizar por impacto real ‚Äî Um risco com severidade "cr√≠tica" mas probabilidade "zero" n√£o √© P0
Reportar "n√£o encontrado" ‚Äî Se um risco n√£o existe, diga explicitamente (√© boa not√≠cia)
FASE 0 ‚Äî DIAGN√ìSTICO COMPLETO
Execute as verifica√ß√µes abaixo na ordem. Para cada verifica√ß√£o, reporte:

‚úÖ Status: CONFIRMADO | N√ÉO ENCONTRADO | PARCIAL
üìä M√©trica: N√∫mero exato (ex: "3 ocorr√™ncias", "0 matches")
üìÅ Arquivos afetados: Lista completa com paths
üéØ Severidade real: CR√çTICA | ALTA | M√âDIA | BAIXA (baseado em impacto √ó probabilidade)
üí° Recomenda√ß√£o: REMEDIAR AGORA | REMEDIAR EM SPRINT | ACEITAR RISCO
VERIFICA√á√ÉO #1 ‚Äî Secrets no Hist√≥rico Git
Objetivo
Confirmar se API keys ainda est√£o acess√≠veis no hist√≥rico Git (mesmo ap√≥s remo√ß√£o no PR #24).

Comandos
bash
# 1. Buscar padr√µes de API keys no hist√≥rico completo
git log --all -p -S "OPENAI_API_KEY" | head -100
git log --all -p -S "GEMINI_API_KEY" | head -50
git log --all -p -S "CLAUDE_API_KEY" | head -50
git log --all -p -S "sk-proj-" | head -50
git log --all -p -S "AIza" | head -50  # Gemini key prefix

# 2. Contar commits que tocaram eas.json
git log --all --oneline -- eas.json | wc -l

# 3. Verificar se eas.json atual est√° limpo
cat eas.json | grep -E "(API_KEY|SECRET|TOKEN)" | wc -l
Crit√©rios de Avalia√ß√£o
Cen√°rio	Status	Severidade	A√ß√£o
Keys encontradas em ‚â•1 commit antigo	‚úÖ CONFIRMADO	CR√çTICA	REMEDIAR AGORA
Keys N√ÉO encontradas no hist√≥rico	‚ùå N√ÉO ENCONTRADO	N/A	‚úÖ PASSOU
eas.json atual cont√©m keys	‚úÖ CONFIRMADO	CR√çTICA	BLOQUEAR DEPLOY
Reporte Esperado
Code
## VERIFICA√á√ÉO #1 ‚Äî Secrets no Hist√≥rico Git

Status: [CONFIRMADO/N√ÉO ENCONTRADO]
M√©trica: [X commits com secrets / 0 ocorr√™ncias]

Arquivos/Commits afetados:
- commit abc123: eas.json linha 45 (OPENAI_API_KEY=sk-proj-...)
- commit def456: eas.json linha 89 (GEMINI_API_KEY=AIza...)
[OU]
- Nenhum secret encontrado no hist√≥rico ‚úÖ

Severidade real: [CR√çTICA/BAIXA]
Recomenda√ß√£o: [REMEDIAR AGORA / PASSOU]
VERIFICA√á√ÉO #2 ‚Äî StyleSheet.create em Uso
Objetivo
Quantificar quantos arquivos violam a regra "NativeWind only" usando StyleSheet.create.

Comandos
bash
# 1. Buscar todos os StyleSheet.create em src/
rg "StyleSheet\.create" src/ --type tsx --type ts -l

# 2. Contar ocorr√™ncias totais
rg "StyleSheet\.create" src/ --type tsx --type ts | wc -l

# 3. Agrupar por pasta
rg "StyleSheet\.create" src/components/ --type tsx --type ts -l | wc -l
rg "StyleSheet\.create" src/screens/ --type tsx --type ts -l | wc -l

# 4. Verificar se ESLint bloqueia
cat .eslintrc.js | grep -A5 "no-restricted-imports"
npm run lint 2>&1 | grep -i "stylesheet"
Crit√©rios de Avalia√ß√£o
Cen√°rio	Status	Severidade	A√ß√£o
‚â•10 arquivos com StyleSheet	‚úÖ CONFIRMADO	ALTA	REMEDIAR EM SPRINT
1-9 arquivos	PARCIAL	M√âDIA	REMEDIAR EM SPRINT
0 arquivos	‚ùå N√ÉO ENCONTRADO	N/A	‚úÖ PASSOU
ESLint N√ÉO bloqueia	‚úÖ CONFIRMADO	M√âDIA	CONFIGURAR LINT RULE
Reporte Esperado
Code
## VERIFICA√á√ÉO #2 ‚Äî StyleSheet.create

Status: [CONFIRMADO/PARCIAL/N√ÉO ENCONTRADO]
M√©trica: [X arquivos / Y ocorr√™ncias totais]

Arquivos afetados (top 10):
1. src/components/login/GlassCard.tsx (3 ocorr√™ncias)
2. src/screens/home/HomeScreen.tsx (15 ocorr√™ncias)
[...]

Distribui√ß√£o por pasta:
- src/components/: 7 arquivos
- src/screens/: 5 arquivos

ESLint bloqueando? [SIM/N√ÉO]

Severidade real: [ALTA/M√âDIA]
Recomenda√ß√£o: [REMEDIAR EM SPRINT / CONFIGURAR LINT]
VERIFICA√á√ÉO #3 ‚Äî Cores Hardcoded
Objetivo
Identificar cores hardcoded fora de tokens.ts (hexadecimal, rgba).

Comandos
bash
# 1. Buscar hex colors (#fff, #FF5733)
rg "#[0-9a-fA-F]{3,6}" src/ --type tsx --type ts -g '!tokens.ts' -g '!__tests__' -n

# 2. Buscar rgba/rgb
rg "rgba?\([0-9]" src/ --type tsx --type ts -g '!tokens.ts' -g '!__tests__' -n

# 3. Verificar ESLint rule
cat .eslintrc.js | grep -i "hardcoded.*color"
npm run lint 2>&1 | grep -i "color"

# 4. Contar viola√ß√µes
rg "#[0-9a-fA-F]{3,6}" src/ -g '!tokens.ts' | wc -l
Crit√©rios de Avalia√ß√£o
Cen√°rio	Status	Severidade	A√ß√£o
‚â•20 ocorr√™ncias	‚úÖ CONFIRMADO	M√âDIA	REMEDIAR EM SPRINT
1-19 ocorr√™ncias	PARCIAL	BAIXA	REMEDIAR EM SPRINT
0 ocorr√™ncias	‚ùå N√ÉO ENCONTRADO	N/A	‚úÖ PASSOU
Reporte Esperado
Code
## VERIFICA√á√ÉO #3 ‚Äî Cores Hardcoded

Status: [CONFIRMADO/PARCIAL/N√ÉO ENCONTRADO]
M√©trica: [X ocorr√™ncias hex / Y ocorr√™ncias rgba]

Top violadores:
1. src/screens/home/HomeScreen.tsx:659 ‚Äî rgba(254, 205, 211, 0.4)
2. src/screens/home/HomeScreen.tsx:666 ‚Äî rgba(233, 213, 255, 0.3)
[...]

ESLint bloqueando? [SIM/N√ÉO]

Severidade real: [M√âDIA/BAIXA]
Recomenda√ß√£o: [REMEDIAR EM SPRINT / PASSOU]
VERIFICA√á√ÉO #4 ‚Äî Testes de Infraestrutura Cr√≠tica
Objetivo
Confirmar aus√™ncia de testes para rate-limiter.ts e usePremiumListener.

Comandos
bash
# 1. Verificar exist√™ncia de testes
ls -la src/utils/__tests__/rate-limiter.test.ts 2>&1
ls -la src/hooks/__tests__/usePremiumListener.test.ts 2>&1

# 2. Rodar coverage em utils e hooks
npm test -- --coverage --collectCoverageFrom='src/utils/rate-limiter.ts' --collectCoverageFrom='src/hooks/usePremiumListener.ts' 2>&1

# 3. Coverage geral de /utils e /hooks
npm test -- --coverage --collectCoverageFrom='src/utils/**/*.ts' --collectCoverageFrom='src/hooks/**/*.ts' --coverageReporters=text-summary 2>&1 | grep -E "(Statements|Branches|Functions|Lines)"

# 4. Listar arquivos cr√≠ticos sem testes
find src/utils -name "*.ts" ! -name "*.test.ts" ! -name "*.d.ts" -exec basename {} \; | while read file; do
  testfile="src/utils/__tests__/${file%.ts}.test.ts"
  [ ! -f "$testfile" ] && echo "‚ùå $file (sem teste)"
done
Crit√©rios de Avalia√ß√£o
Cen√°rio	Status	Severidade	A√ß√£o
rate-limiter.ts sem testes	‚úÖ CONFIRMADO	ALTA	REMEDIAR AGORA
usePremiumListener sem testes	‚úÖ CONFIRMADO	ALTA	REMEDIAR AGORA
Coverage /utils < 80%	‚úÖ CONFIRMADO	M√âDIA	REMEDIAR EM SPRINT
Coverage /hooks < 80%	‚úÖ CONFIRMADO	M√âDIA	REMEDIAR EM SPRINT
Reporte Esperado
Code
## VERIFICA√á√ÉO #4 ‚Äî Testes de Infraestrutura

Status: [CONFIRMADO/PARCIAL/N√ÉO ENCONTRADO]

Arquivos cr√≠ticos sem testes:
- ‚ùå src/utils/rate-limiter.ts
- ‚ùå src/hooks/usePremiumListener.ts
[OU]
- ‚úÖ Todos os arquivos cr√≠ticos possuem testes

Coverage atual:
- src/utils/: [X%] statements, [Y%] branches
- src/hooks/: [X%] statements, [Y%] branches

Severidade real: [ALTA/M√âDIA]
Recomenda√ß√£o: [REMEDIAR AGORA / REMEDIAR EM SPRINT]
VERIFICA√á√ÉO #5 ‚Äî Observabilidade de New Architecture
Objetivo
Verificar se crashes relacionados √† New Architecture podem ser rastreados no Sentry.

Comandos
bash
# 1. Verificar se New Architecture est√° habilitada
cat app.json | grep -A2 "newArchEnabled"

# 2. Buscar tags Sentry no c√≥digo
rg "Sentry\.(init|setTag)" src/ --type tsx --type ts -A3
rg "architecture.*new" src/ --type tsx --type ts

# 3. Verificar se existe runbook de rollback
ls -la docs/release/*ARCHITECTURE* docs/release/*ROLLBACK* 2>&1

# 4. Buscar uso de TurboModules/Fabric
rg "TurboModule|Fabric" src/ --type tsx --type ts -l
Crit√©rios de Avalia√ß√£o
Cen√°rio	Status	Severidade	A√ß√£o
New Arch habilitada + Sem tag Sentry	‚úÖ CONFIRMADO	M√âDIA	REMEDIAR EM SPRINT
New Arch habilitada + Sem runbook	‚úÖ CONFIRMADO	BAIXA	CRIAR DOCS
New Arch desabilitada	‚ùå N√ÉO APLIC√ÅVEL	N/A	N/A
Reporte Esperado
Code
## VERIFICA√á√ÉO #5 ‚Äî New Architecture Observability

Status: [CONFIRMADO/N√ÉO APLIC√ÅVEL]

New Architecture habilitada? [SIM/N√ÉO]
Tag Sentry configurada? [SIM/N√ÉO]
Runbook de rollback existe? [SIM/N√ÉO]

Severidade real: [M√âDIA/BAIXA/N/A]
Recomenda√ß√£o: [REMEDIAR EM SPRINT / N/A]
VERIFICA√á√ÉO B√îNUS ‚Äî Quality Gate Atual
Objetivo
Baseline da qualidade geral do projeto.

Comandos
bash
# 1. Rodar quality gate
npm run quality-gate 2>&1

# 2. TypeScript
npm run typecheck 2>&1 | tail -20

# 3. ESLint
npm run lint 2>&1 | grep -E "(warning|error)" | wc -l

# 4. Testes
npm test 2>&1 | grep -E "(Tests|Suites)"

# 5. Build readiness
npm run diagnose:production 2>&1 | tail -10
Reporte Esperado
Code
## VERIFICA√á√ÉO B√îNUS ‚Äî Quality Gate

Quality Gate Status: [PASSED/FAILED]

TypeScript: [X errors / Y warnings]
ESLint: [X errors / Y warnings]
Tests: [X/Y passed]
Build Ready: [YES/NO]

Observa√ß√µes:
[listar bloqueadores se houver]
FORMATO DE ENTREGA FINAL
Ap√≥s executar todas as verifica√ß√µes, compile um relat√≥rio consolidado:

Markdown
# üîç RELAT√ìRIO DE VERIFICA√á√ÉO DIAGN√ìSTICA

**Reposit√≥rio:** LionGab/NossaMaternidade  
**Data:** YYYY-MM-DD  
**Executor:** [seu nome/agente]

---

## RESUMO EXECUTIVO

| Risco | Status Confirmado | Severidade Real | Prioridade |
|-------|-------------------|-----------------|------------|
| #1 Secrets no Git | [‚úÖ/‚ùå] | [CR√çTICA/BAIXA] | [P0/P1/P2] |
| #2 StyleSheet | [‚úÖ/‚ùå] | [ALTA/M√âDIA] | [P0/P1/P2] |
| #3 Cores Hardcoded | [‚úÖ/‚ùå] | [M√âDIA/BAIXA] | [P0/P1/P2] |
| #4 Testes Faltando | [‚úÖ/‚ùå] | [ALTA/M√âDIA] | [P0/P1/P2] |
| #5 New Arch Obs | [‚úÖ/‚ùå] | [M√âDIA/N/A] | [P0/P1/P2] |

**Total de riscos confirmados:** X/5  
**Bloqueadores P0:** X  
**Itens P1:** X

---

## DETALHAMENTO POR RISCO

[colar todos os reportes individuais das verifica√ß√µes #1-#5]

---

## QUALITY GATE BASELINE

[colar verifica√ß√£o b√¥nus]

---

## RECOMENDA√á√ÉO FINAL

**Ordem de execu√ß√£o sugerida:**

1. [Risco com prioridade P0 #1]
2. [Risco com prioridade P0 #2]
3. [Risco com prioridade P1 #1]
...

**Riscos que N√ÉO precisam remedia√ß√£o:**
- [listar riscos com status "N√ÉO ENCONTRADO"]

**Estimativa de esfor√ßo total:** X horas

---

## PR√ìXIMOS PASSOS

[ ] Aprovar ordem de remedia√ß√£o
[ ] Executar FASE 1 (P0)
[ ] Executar FASE 2 (P1)
[ ] Valida√ß√£o final (quality-gate + coverage)
[ ] Abrir PR de remedia√ß√£o
REGRAS CR√çTICAS DE EXECU√á√ÉO
‚ùå N√ÉO execute corre√ß√µes ‚Äî apenas diagn√≥stico
‚úÖ SEMPRE rode o comando antes de reportar
‚úÖ Quantifique tudo ‚Äî "12 arquivos", n√£o "v√°rios"
‚úÖ Se n√£o encontrar, diga explicitamente ‚Äî "0 ocorr√™ncias ‚úÖ"
‚úÖ Priorize por (severidade √ó probabilidade) ‚Äî n√£o s√≥ severidade te√≥rica