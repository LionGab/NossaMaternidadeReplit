---
description: Regras obrigatÃ³rias para builds EAS (iOS/Android)
globs: ["**/build*.md", "**/eas.json", "**/app.config.js"]
alwaysApply: true
---

# Build Standards - Regras ObrigatÃ³rias

## A) Regra dos 70% (Gatilho de Contexto)

**OBRIGATÃ“RIO** no inÃ­cio de qualquer comando de build:

1. Executar `/context` (ou verificar uso de contexto)
2. **Se uso >= 70%**:
   - Criar checkpoint: `docs/builds/YYYY-MM-DD-{platform}-{profile}.md`
   - Executar `/compact`
   - Continuar **somente apÃ³s** compactaÃ§Ã£o
3. **Se uso < 70%**: continuar normalmente

## B) PersistÃªncia por Build (Anti NOTES.md Gigante)

**PadrÃ£o**: 1 arquivo por build em `docs/builds/`

**NOTES.md** deve conter **apenas**:
- Resumo em 3 bullets
- Link do arquivo de checkpoint
- Link do log completo (se existir)

**Template**: `docs/builds/TEMPLATE.md`

## C) Regra Anti-Log-PoluiÃ§Ã£o

**NUNCA** colar logs completos no chat.

**SEMPRE**:
1. Colar apenas **trecho mÃ­nimo**: erro + ~20 linhas acima/abaixo
2. Salvar log completo em: `docs/builds/logs/{build-id}.txt`
3. Referenciar no checkpoint

**Campos obrigatÃ³rios no checkpoint**:
- "Trecho mÃ­nimo no chat" (o que foi mostrado)
- "Log completo em arquivo" (path do .txt)

## D) Modo Entrevista com EvidÃªncia

**ANTES** de gerar plano ou rodar comandos de build:

### Entrevista ObrigatÃ³ria (4 perguntas):

1. **Plataforma**: iOS / Android / Ambos?
2. **Profile**: development / preview / production?
3. **Auto-submit**: Se production, submeter automaticamente?
4. **Branch + Objetivo**: Em qual branch? Qual o objetivo deste build?

### ApÃ³s Entrevista:

1. Ler este arquivo (build-standards.mdc)
2. **MOSTRAR EVIDÃŠNCIA**: Listar 3 itens P0 do checklist que serÃ£o verificados

**Exemplo de evidÃªncia**:
```
ðŸ“‹ P0 Checklist que serÃ¡ verificado:
1. Nenhum console.log em src/
2. Copy correto: "Quando vocÃª comeÃ§ou a tentar?"
3. Nenhuma cor hardcoded (#xxx, rgba)
```

## E) Checklist Copy/UI como Gate

**ANTES** de tsc/lint, validar Copy/UI P0:

### Itens P0 (Bloqueantes):

| Item | VerificaÃ§Ã£o | Comando |
|------|-------------|---------|
| console.log | Nenhum em src/ | `grep -r "console.log" src/` |
| any types | Nenhum sem justificativa | `grep -r ": any" src/` |
| Cores hardcoded | Nenhum #xxx, rgba(), 'white', 'black' | Grep em .tsx |
| Copy "tentando" | "Quando vocÃª comeÃ§ou a tentar?" | Busca manual |
| Copy "mÃªs" | "cada mÃªs" (nÃ£o "ciclo") | Busca manual |
| Emoji/Ã­cones | Renderizam corretamente (nÃ£o texto) | Verificar screenshots |

### Se Violar:

1. **INTERROMPER** build imediatamente
2. Listar: `arquivo:linha` de cada violaÃ§Ã£o
3. Aguardar correÃ§Ã£o antes de continuar

---

## Fluxo Completo de Build

```
1. /context â†’ verificar uso
2. Se >= 70% â†’ checkpoint + /compact
3. Entrevista (4 perguntas)
4. Mostrar evidÃªncia (3 P0s)
5. Validar Copy/UI P0
6. quality-gate (tsc + lint + build check)
7. eas build --platform X --profile Y
8. Atualizar NOTES.md (3 bullets + links)
9. Criar/atualizar checkpoint
```

## ReferÃªncias

- Template: `docs/builds/TEMPLATE.md`
- NOTES: `docs/builds/NOTES.md`
- Logs: `docs/builds/logs/`
